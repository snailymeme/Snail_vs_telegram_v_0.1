# Прогресс разработки "Snail vs Telegram"

## Общая информация
- **Название игры**: Snail vs Telegram
- **Репозиторий**: https://github.com/snailymeme/Snail_vs_telegram_v_0.1
- **Дата начала**: Апрель 2025

## Этапы разработки

### Создание основных компонентов игры

1. **Подготовка базовой структуры**
   - Создан файл `index.html` с основной разметкой игры
   - Структурированы папки `css/`, `js/` и `images/`
   - Реализована базовая верстка игровых экранов

2. **Разработка игровой логики**
   - Создан модуль `js/assets.js` для хранения констант, путей к ресурсам и конфигурации
   - Разработан генератор лабиринтов `js/maze.js` с использованием алгоритма случайного пути
   - Реализован класс Улитки `js/snail.js` с различными типами поведения
   - Создан основной игровой модуль `js/game.js` для управления состоянием игры
   - Добавлен файл `js/main.js` как точка входа в приложение

3. **Добавление ресурсов**
   - Подготовлены спрайты для 5 типов улиток: Red (Racer), Blue (Explorer), Green (Snake), Purple (Stubborn), Yellow (Deadender)
   - Созданы текстуры для элементов лабиринта: стены, пути, старт, финиш
   - Добавлены дополнительные изображения для специальных клеток (ловушки, ускорители)

4. **Реализация типов улиток с разным поведением**
   - **Racer**: Быстрая улитка, может получать случайное ускорение
   - **Explorer**: Исследует лабиринт, может находить короткие пути
   - **Snake**: Передвигается зигзагом, быстрее выходит из тупиков
   - **Stubborn**: Упрямо движется в выбранном направлении
   - **Deadender**: Любит заходить в тупики, неожиданно меняет направление

### Интеграция с Telegram

1. **Разработка Telegram бота**
   - Создан файл `bot.js` для взаимодействия с Telegram API
   - Реализована обработка команд `/start` и `/help`
   - Добавлена кнопка для запуска Telegram Web App

2. **Настройка HTTPS-доступа**
   - Реализован модуль `run-ngrok.js` для создания защищенного HTTPS-туннеля
   - Создан скрипт `restart.sh` для автоматизации процесса запуска

3. **Оптимизация под WebApp**
   - Адаптирован интерфейс для работы в Telegram Web App
   - Добавлена возможность запуска игры прямо в Telegram

### Улучшения рендеринга игры и исправление ошибок

1. **Обновление игрового движка**
   - Полностью переработан метод `update` в классе `Game` для корректного обновления состояния улиток и лабиринта
   - Реализовано очищение canvas перед каждым кадром для предотвращения артефактов отрисовки
   - Добавлена анимация стилей лабиринта с использованием канваса вместо статического изображения

2. **Исправления в классе `Snail`**
   - Обновлен метод `move` для правильного обновления позиции улитки на канвасе
   - Добавлена обработка специальных случаев, когда улитка застревает или достигает финиша
   - Реализована синхронизация между логической позицией в массиве и координатами для отрисовки

3. **Модификации в классе `Maze`**
   - Изменен конструктор для генерации лабиринта сразу при создании объекта
   - Добавлена проверка наличия валидного пути от старта до финиша
   - Улучшена интеграция стилей лабиринта с системой рендеринга

4. **Исправление проблем с выбором улиток**
   - Обновлены селекторы и атрибуты данных для корректного выбора улитки при клике
   - Добавлены прямые обработчики событий onclick для элементов выбора улиток
   - Улучшена система логирования для отслеживания состояния игры
   - Оптимизированы стили CSS для улучшения интерактивности на мобильных устройствах

5. **Создание нового репозитория**
   - Создан новый репозиторий на GitHub: Snail_vs_telegram_v_0.1
   - Перенесен весь код проекта в новый репозиторий
   - Настроена синхронизация локального и удаленного репозиториев

### Структура проекта

- **Фронтенд**:
  - `index.html` - основной HTML-файл с разметкой игры
  - `css/` - стили для игрового интерфейса
    - `styles.css` - основные стили
    - `style.css` - дополнительные стили
  - `js/` - JavaScript-модули
    - `assets.js` - константы и конфигурация
    - `game.js` - основная игровая логика
    - `maze.js` - генерация лабиринта
    - `snail.js` - классы улиток
    - `main.js` - точка входа
    - `modules/` - дополнительные модули
      - `config.js` - настройки
      - `gameState.js` - управление состоянием
      - `ui.js` - взаимодействие с интерфейсом
    - `mazeStyles.js` - стили для лабиринта
    - `snail-manager.js` - управление улитками

- **Бэкенд**:
  - `bot.js` - Telegram бот
  - `run-ngrok.js` - настройка HTTPS-туннеля
  - `restart.sh` - скрипт запуска всех компонентов

- **Ресурсы**:
  - `images/` - графические ресурсы
    - `red_snail.png` - улитка типа Racer
    - `blue_snail.png` - улитка типа Explorer
    - `green_snail.png` - улитка типа Snake
    - `purple_snail.png` - улитка типа Stubborn
    - `yellow_snail.png` - улитка типа Deadender
    - `wall_texture.png` - текстура стены
    - `path_texture.png` - текстура пути
    - `start.png` - изображение старта
    - `finish.png` - изображение финиша

### Решенные проблемы

1. **Оптимизация игрового движка**
   - Улучшена производительность рендеринга лабиринта
   - Оптимизирован алгоритм поиска пути для улиток
   - Исправлены проблемы с отрисовкой улиток на канвасе

2. **Интеграция с Telegram Web App**
   - Решена проблема с требованием HTTPS для Web App
   - Настроен ngrok для создания защищенного соединения
   - Исправлены проблемы с выбором улиток в интерфейсе Telegram

3. **Настройка деплоя**
   - Создан единый скрипт `restart.sh` для запуска всех компонентов
   - Реализована обработка ошибок и журналирование
   - Улучшена стабильность запуска и перезапуска приложения

## Текущие задачи

- [ ] Улучшение баланса игры
- [ ] Добавление аудио
- [ ] Реализация системы достижений
- [ ] Добавление аналитики
- [ ] Улучшение визуальных эффектов

## История версий

### Версия 0.1.0
- Базовая игровая механика
- Генерация лабиринта
- Движение улиток

### Версия 0.2.0
- Добавлены различные типы улиток
- Реализована система ставок

### Версия 0.3.0
- Интеграция с Telegram
- Запуск через Web App

### Версия 0.4.0
- Улучшен рендеринг лабиринта и улиток на канвасе
- Исправлены проблемы с выбором улиток в интерфейсе
- Оптимизирована работа под мобильные устройства
- Создан новый репозиторий v_0.1 